<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}"
>
    <head>
        <title>Chi tiết đơn hàng</title>
    </head>
    <body>
        <div layout:fragment="content">
            <div class="mb-3">
                <a href="/admin/orders" class="btn btn-secondary">
                    Quay lại danh sách đơn hàng
                </a>
            </div>

            <div class="card" th:if="${order != null}">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        Chi tiết đơn hàng #<span th:text="${order.id}">1</span>
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Thông tin khách hàng</h5>
                            <p>
                                <strong>Tên:</strong>
                                <span th:text="${order.customer.name}"
                                    >Customer</span
                                >
                            </p>
                            <p>
                                <strong>Username:</strong>
                                <span th:text="${order.customer.username}"
                                    >username</span
                                >
                            </p>
                            <p>
                                <strong>Role:</strong>
                                <span
                                    class="badge"
                                    th:classappend="${order.customer.role == 'ADMIN' ? 'bg-danger' : 'bg-success'}"
                                    th:text="${order.customer.role}"
                                >
                                    CUSTOMER
                                </span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5>Thông tin đơn hàng</h5>
                            <p>
                                <strong>Ngày đặt:</strong>
                                <span
                                    th:text="${#dates.format(order.date, 'dd/MM/yyyy HH:mm:ss')}"
                                >
                                    01/01/2024
                                </span>
                            </p>
                            <p>
                                <strong>Tổng sản phẩm:</strong>
                                <span
                                    th:text="${order.orderLines.size()} + ' sản phẩm'"
                                    >0</span
                                >
                            </p>
                        </div>
                    </div>

                    <h5>Chi tiết sản phẩm</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th>Danh mục</th>
                                    <th>Số lượng</th>
                                    <th>Đơn giá</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="line : ${order.orderLines}">
                                    <td th:text="${line.product.name}">
                                        Product
                                    </td>
                                    <td th:text="${line.product.category.name}">
                                        Category
                                    </td>
                                    <td th:text="${line.amount}">1</td>
                                    <td
                                        th:text="${#numbers.formatDecimal(line.purchasePrice, 0, 'COMMA', 0, 'POINT')} + ' đ'"
                                    >
                                        0 đ
                                    </td>
                                    <td>
                                        <strong
                                            th:text="${#numbers.formatDecimal(line.purchasePrice.doubleValue() * line.amount, 0, 'COMMA', 0, 'POINT')} + ' đ'"
                                        >
                                            0 đ
                                        </strong>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="table-primary">
                                    <td colspan="4" class="text-end">
                                        <strong>Tổng cộng:</strong>
                                    </td>
                                    <td>
                                        <strong
                                            class="text-danger fs-5"
                                            th:text="${#numbers.formatDecimal(orderService.calculateTotal(order), 0, 'COMMA', 0, 'POINT')} + ' đ'"
                                        >
                                            0 đ
                                        </strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div class="mt-3" style="display: none">
                        <form
                            th:action="@{/admin/orders/delete/{id}(id=${order.id})}"
                            method="post"
                            onsubmit="return confirm('Bạn có chắc muốn xóa đơn hàng này?')"
                        >
                            <button type="submit" class="btn btn-danger">
                                Xóa đơn hàng
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning" th:if="${order == null}">
                Không tìm thấy đơn hàng
            </div>
        </div>
    </body>
</html>
